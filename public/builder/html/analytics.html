<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(
j,f);})(window,document,'script','dataLayer','GTM-PHS2VK');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript>
<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-
PHS2VK "height="0" width="0" style="display:none;visibility:hidden">
</iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->


<!-- Analytics implementation -->
<script>
window.addEventListener('load', () =>
{
  const isTYP = document.querySelector('section.c-thank-you');
  const pageView = {
    event: 'virtual_pageview',
    page_info: {
      page_location: window.location.href,
      page_language: document.querySelector('html').getAttribute('lang').substring(0, 2),
      page_status: 'ok200',
      // page_referrer: 'https://www.bsm.upf.edu/es/executive-mba-emba',
      // page_destination: '/es/',
      page_template: isTYP ? 'pagina confirmacion' : 'product',
      // page_template_referrer: 'home',
    },
    // program_info: {
    //   program_id: 015050,
    //   program_name: 'Executive MBA',
    //   program_type: 'mba',
    //   program_area: '30',
    //   program_modality: 'Presencial',
    //   program_language: 'Castellano',
    // },
  };
  console.log(pageView);
  dataLayer.push(pageView);

  if (isTYP)
  {
    const formConfirmation = {
      event: 'contact_form_confirmation',
      contact_form_info: {
        contact_form_name: 'solicita informacion',
        // contact_form_id: '1234',
        contact_form_location: 'cta sticky',
        contact_form_step: 'pagina confirmacion',
        value: 1,
        // conversion_id: 'OPP-205922',
        ecommerce_timestamp_in_utc: new Date().toISOString(),
        // contact_form_interest_point: 'Executive MBA',
      },
      // program_info: {
      //   program_id: '015000',
      //   program_name: 'Executive MBA',
      //   program_area: '30',
      // },
    };
    const programInfo = sessionStorage.getItem('program_info');
    if (programInfo)
    {
      const info = JSON.parse(programInfo);
      formConfirmation.program_info = info;
      formConfirmation.contact_form_info.contact_form_interest_point = info.program_name;
    }
    console.log(formConfirmation);
    dataLayer.push(formConfirmation);
    sessionStorage.removeItem('program_info');
  }
})
</script>
